let lenis;"scrollRestoration"in history&&(history.scrollRestoration="manual"),window.addEventListener("beforeunload",()=>{document.documentElement.style.backgroundColor="#0a0a0a",document.body.style.backgroundColor="#0a0a0a",window.scrollTo(0,0)}),window.addEventListener("focus",()=>{document.body.style.backgroundColor=""});let TRANSLATIONS={},LANG=(localStorage.getItem("lang")||"en").toLowerCase(),toastTimeoutId=null;const MotionPreferences={get prefersReducedMotion(){return window.matchMedia("(prefers-reduced-motion: reduce)").matches}};function trackEvent(e,t={}){"undefined"!=typeof window&&"function"==typeof window.gtag&&window.gtag("event",e,t)}function loadScript(e){return new Promise((t,n)=>{if(document.querySelector(`script[src="${e}"]`))return void t();const o=document.createElement("script");o.src=e,o.onload=t,o.onerror=n,document.head.appendChild(o)})}const PRISM_ASSETS=["./assets/vendor/prism.min.js","./assets/vendor/prism-clike.min.js","./assets/vendor/prism-c.min.js","./assets/vendor/prism-cpp.min.js","./assets/vendor/prism-csharp.min.js","./assets/vendor/prism-nasm.min.js"];async function loadProjectPrism(){if(!window.Prism)try{for(const e of PRISM_ASSETS)await loadScript(e)}catch(e){console.warn("Failed to load Prism assets:",e)}}const DeviceDetector={get isTouchDevice(){return!window.matchMedia("(hover: hover) and (pointer: fine)").matches},get isMobilePortrait(){return window.matchMedia("(max-width: 820px) and (orientation: portrait)").matches},get isTablet(){return window.matchMedia("(min-width: 820px) and (max-width: 1024px)").matches},get isMobile(){return window.matchMedia("(max-width: 820px)").matches},get layout(){const e=window.innerWidth;return e<820?"mobile":e<=1024?"tablet":"desktop"}},LayoutCache={_cache:new Map,_scheduled:!1,get(e){if(!e)return null;let t=this._cache.get(e);return t||(t=this.update(e)),t},update(e){if(!e)return null;const t=e.getBoundingClientRect(),n=window.getComputedStyle(e),o={left:t.left,top:t.top,right:t.right,bottom:t.bottom,width:t.width,height:t.height,offsetLeft:e.offsetLeft,offsetTop:e.offsetTop,offsetWidth:e.offsetWidth,offsetHeight:e.offsetHeight,paddingRight:n.paddingRight,timestamp:performance.now()};return this._cache.set(e,o),o},invalidate(e){e?this._cache.delete(e):this._cache.clear()},refreshAll(){for(const e of this._cache.keys())this.update(e)},scheduleRefresh(){this._scheduled||(this._scheduled=!0,requestAnimationFrame(()=>{this.refreshAll(),this._scheduled=!1}))}};function getToastContainer(){let e=document.getElementById("toast-root");return e||(e=document.createElement("div"),e.id="toast-root",e.className="fixed bottom-6 right-4 md:right-6 z-[11000] flex flex-col items-end gap-3 pointer-events-none",document.body.appendChild(e)),e}function showToast(e,t="info"){const n=getToastContainer();if(!n)return;const o=TRANSLATIONS&&TRANSLATIONS[e]||e;let i=n.querySelector(".js-toast");if(!i){i=document.createElement("div"),i.className="js-toast pointer-events-auto rounded-full border bg-zinc-900/90 backdrop-blur px-4 py-2.5 text-xs md:text-sm shadow-[0_20px_45px_rgba(0,0,0,0.45)] flex items-center gap-2 translate-y-4 opacity-0 transition-all duration-200 border-white/15 text-muted",i.setAttribute("role","status"),i.setAttribute("aria-live","polite");const e=document.createElement("span");e.className="js-toast-dot inline-block h-1.5 w-1.5 rounded-full bg-zinc-400";const t=document.createElement("span");t.className="js-toast-text font-mono tracking-tight",i.appendChild(e),i.appendChild(t),n.appendChild(i)}const a=i.querySelector(".js-toast-text"),r=i.querySelector(".js-toast-dot");a&&(a.textContent=o),i.className="js-toast pointer-events-auto rounded-full border bg-zinc-900/90 backdrop-blur px-4 py-2.5 text-xs md:text-sm shadow-[0_20px_45px_rgba(0,0,0,0.45)] flex items-center gap-2 translate-y-4 opacity-0 transition-all duration-200 border-white/15 text-muted",r&&(r.className="js-toast-dot inline-block h-1.5 w-1.5 rounded-full bg-zinc-400"),requestAnimationFrame(()=>{i.classList.remove("translate-y-4","opacity-0"),i.classList.add("translate-y-0","opacity-100")}),toastTimeoutId&&clearTimeout(toastTimeoutId),toastTimeoutId=setTimeout(()=>{i.classList.remove("translate-y-0","opacity-100"),i.classList.add("translate-y-4","opacity-0")},2800)}function getContactEmail(){return"contact@marciorosendo.com"}window.addEventListener("resize",()=>LayoutCache.scheduleRefresh(),{passive:!0}),window.addEventListener("scroll",()=>{LayoutCache.scheduleRefresh()},{passive:!0});const FORMSUBMIT_ACTION_ID="745f01047216c630f11b06726d99c0f1";function getFormSubmitAction(){return`https://formsubmit.co/${FORMSUBMIT_ACTION_ID}`}function initContactIdentity(){const e=getContactEmail(),t=document.getElementById("email-display");t&&(t.textContent=e);const n=document.getElementById("contact-form");n&&(n.action=getFormSubmitAction());const o=document.getElementById("email-card");o&&(o.addEventListener("click",()=>window.copyEmailToClipboard()),o.addEventListener("keydown",e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),window.copyEmailToClipboard())}))}function _getValidLanguage(e){const t=(e||"").toLowerCase();return"pt"===t?"pt-br":"en"!==t&&"pt-br"!==t?"en":t}function applyDocumentLanguage(){document.documentElement.setAttribute("lang","pt-br"===LANG?"pt-BR":"en")}async function loadTranslations(e,t=!1){try{const n=(new Date).getTime(),o=await fetch(`i18n/${e}.json?v=${n}`);if(!o.ok)throw new Error(`Erro ao carregar tradução: ${o.statusText}`);TRANSLATIONS=await o.json(),translatePage(t)}catch(e){console.error(e)}}window.copyEmailToClipboard=async function(){const e=getContactEmail(),t=document.getElementById("copy-email-btn"),n=t?t.className:"",o=t?t.querySelector(".copy-icon"):null,i=t?t.querySelector(".copy-check-icon"):null;try{await navigator.clipboard.writeText(e),showToast("toast_email_copied","success"),t&&(o&&o.classList.add("hidden"),i&&i.classList.remove("hidden"),setTimeout(()=>{t&&(t.className=n),o&&o.classList.remove("hidden"),i&&i.classList.add("hidden")},1200))}catch(e){console.error("Failed to copy:",e),showToast("toast_email_error","error")}},document.fonts&&document.fonts.ready?document.fonts.ready.then(()=>{document.body.classList.add("fonts-loaded")}):document.body.classList.add("fonts-loaded"),LANG=_getValidLanguage(LANG);let translationTimeline=null;function translatePage(e=!1){const t=document.querySelectorAll("[data-translate]"),n=document.querySelectorAll("#hero > *"),o=document.getElementById("about"),i=o?.querySelector(".section-divider"),a=[o.querySelector("h2")?.parentElement,o.querySelector(".about-photo-card"),...o.querySelectorAll(".spotlight-card")],r=document.querySelector(".marquee-container")?.closest("section"),s=document.getElementById("timeline"),l=s?.querySelector(".section-divider"),c=[s?.querySelector("h2")?.parentElement,document.getElementById("timeline-mobile"),document.getElementById("timeline-desktop")],d=document.getElementById("projects"),u=d?.querySelector(".section-divider"),m=[d.querySelector("h2")?.parentElement,d.querySelector(".accordion-container")],h=document.getElementById("contact"),g=h?.querySelector(".section-divider"),p=[h.querySelector(".grid.grid-cols-1")],f=document.querySelector("footer"),v=f?.querySelector("p");let y=[...n,i,...a,r,l,...c,u,...m,g,...p,v].filter(e=>e);DeviceDetector.isMobile&&(y=y.filter(e=>"language-toggle-hero"!==e.id&&("function"!=typeof e.querySelector||!e.querySelector("#language-toggle-hero"))));function w(){t.forEach(e=>{const t=e.getAttribute("data-translate");if(TRANSLATIONS[t])if(e.hasAttribute("placeholder"))e.placeholder=TRANSLATIONS[t];else if("META"===e.tagName)e.content=TRANSLATIONS[t];else{const n=TRANSLATIONS[t];-1===n.indexOf("<")?e.textContent=n:e.innerHTML=n}}),LayoutCache.invalidate(),window.renderProjects&&window.renderProjects();const e=document.getElementById("project-modal");e&&e.classList.contains("active")&&renderModalContent(currentProjectIndex),requestAnimationFrame(()=>{"undefined"!=typeof ScrollTrigger&&ScrollTrigger.refresh()})}if(MotionPreferences.prefersReducedMotion)return w(),void updateLanguageToggle();translationTimeline&&(translationTimeline.kill(),gsap.set(document.body,{clearProps:"pointerEvents"}));const b=document.querySelectorAll("#timeline .grid > div, #timeline .timeline-dot, #timeline .timeline-line"),E=y.filter(e=>!Array.from(b).includes(e));if(gsap.killTweensOf(E),navbarHighlight){navbarHighlight._updateActiveSection();const e=navbarHighlight.activeElement;e&&navbarHighlight.setActive(e)}if(e)return w(),updateLanguageToggle(),navbarHighlight&&navbarHighlight.container&&navbarHighlight.updateHighlight(),void animateHeroEntrance();translationTimeline=gsap.timeline({onComplete:()=>{gsap.set(document.body,{clearProps:"pointerEvents"}),languageHighlight&&languageHighlight.updateHighlight(),navbarHighlight&&navbarHighlight.updateHighlight(),heroLanguageHighlight&&heroLanguageHighlight.updateHighlight()}});const S=translationTimeline;S.add("start"),S.set(document.body,{pointerEvents:"none"},"start"),S.set(y,{transition:"none"},"start"),navbarHighlight&&S.add(navbarHighlight.hide(),"start"),languageHighlight&&!DeviceDetector.isMobile&&S.add(languageHighlight.hide(),"start"),y.forEach((e,t)=>{const n="start+="+.018*t;S.to(e,{opacity:0,duration:.32,ease:"power2.in"},n)}),S.call(w),S.add("enter",">+0.06"),S.add(()=>{if(!navbarHighlight)return;navbarHighlight._updateActiveSection();const e=navbarHighlight.activeElement;e&&navbarHighlight.setActive(e)},"enter"),navbarHighlight&&S.add(navbarHighlight.show(),"enter"),languageHighlight&&!DeviceDetector.isMobile&&S.add(languageHighlight.show(),"enter"),y.forEach((e,t)=>{const n="enter+="+.018*t;S.fromTo(e,{opacity:0},{opacity:1,duration:.42,ease:"power2.out",clearProps:"opacity,transition"},n)}),updateLanguageToggle()}function animateHeroEntrance(){if(MotionPreferences.prefersReducedMotion)return;const e=document.getElementById("hero");if(!e)return;const t=[e.querySelector('[data-translate="hero_status"]')?.parentElement,e.querySelector('[data-translate="hero_title_1"]'),e.querySelector('[data-translate="hero_title_2"]')].filter(e=>e);gsap.set(t,{opacity:0,y:30}),gsap.to(t,{opacity:1,y:0,duration:.8,stagger:.1,ease:"power2.out",clearProps:"all"})}function setLanguage(e){const t=_getValidLanguage(e);if(LANG===t)return void updateLanguageToggle();LANG=t,localStorage.setItem("lang",LANG),applyDocumentLanguage(),loadTranslations(LANG),trackEvent("language_switch",{event_category:"ui",event_label:t});const n=document.getElementById("language-toggle"),o=n?.querySelector(`[data-lang="${t}"]`);o&&languageHighlight&&languageHighlight.setActive(o);const i=document.getElementById("language-toggle-hero"),a=i?.querySelector(`[data-lang="${t}"]`);a&&heroLanguageHighlight&&heroLanguageHighlight.setActive(a)}function updateLanguageToggle(){const e=document.getElementById("language-toggle");if(e&&(e.setAttribute("data-active-lang",LANG),languageHighlight)){const t=e.querySelector(`[data-lang="${LANG}"]`);t&&(languageHighlight.activeElement=t,languageHighlight.updateHighlight())}if(document.querySelectorAll(".js-lang-btn[data-lang]").forEach(e=>{e.setAttribute("aria-pressed",e.getAttribute("data-lang")===LANG)}),document.querySelectorAll('[data-language-toggle="tubelight"]').forEach(e=>e.setAttribute("data-active-lang",LANG)),heroLanguageHighlight){const e=document.getElementById("language-toggle-hero"),t=e?.querySelector(`[data-lang="${LANG}"]`);t&&(heroLanguageHighlight.activeElement=t,heroLanguageHighlight.updateHighlight())}navbarHighlight&&navbarHighlight.container&&navbarHighlight.updateHighlight()}class BaseHighlight{constructor(){this.container=null,this.items=[],this.hoverOutline=null,this.isTranslating=!1,this.hoveredElement=null,this.isTouchDevice=DeviceDetector.isTouchDevice}_getAnimationTargets(){throw new Error("_getAnimationTargets() must be implemented by subclass")}onHoverStart(e){this.isTranslating||this.isTouchDevice||(this.hoveredElement=e,this._animateHoverOutline(e,.2))}onHoverEnd(){this.isTranslating||this.isTouchDevice||(this.hoveredElement=null,this._hideHoverOutline())}hide(){this.isTranslating=!0,this._hideHoverOutline();const e=this._getAnimationTargets();return this.isTouchDevice||!this._shouldSlideOnHide()?gsap.to(e,{opacity:0,duration:.3,ease:"power2.in",onStart:()=>{this.isTouchDevice&&e.forEach(e=>{e.style.pointerEvents="none"})}}):gsap.to(e,{y:this._getHideDirection(),opacity:0,duration:.3,ease:"power2.in"})}show(){const e=this._getAnimationTargets();return this.isTouchDevice?gsap.to(e,{opacity:1,duration:.4,ease:"power2.out",onComplete:()=>{e.forEach(e=>{e.style.pointerEvents=""}),this.isTranslating=!1}}):gsap.to(e,{y:"0%",opacity:1,duration:.4,ease:"power2.out",onComplete:()=>{this.isTranslating=!1}})}_getAdaptiveDuration(e,t=.35,n={}){const o=n.min||.15,i=n.max||t;if(!this.lamp||!e)return t;const a=LayoutCache.get(this.lamp),r=LayoutCache.get(e),s=this.container?LayoutCache.get(this.container):null;if(!a||!r||!s)return t;const l=s.width,c=a.left,d=a.right,u=r.left,m=r.right,h=Math.max(Math.abs(u-c),Math.abs(m-d));if(!h||!l)return t;let g=t*Math.min(1,h/l);return g="undefined"!=typeof gsap&&gsap.utils?.clamp?gsap.utils.clamp(o,i,g):Math.max(o,Math.min(i,g)),g}_calculatePosition(e){const t=LayoutCache.get(e);return t?{left:t.offsetLeft,width:t.offsetWidth}:{left:0,width:0}}_animateHoverOutline(e,t=.2){if(!this.hoverOutline)return;const n=this._calculatePosition(e);gsap.to(this.hoverOutline,{left:n.left,width:n.width,opacity:1,duration:t,ease:"power2.out"})}_hideHoverOutline(){this.hoverOutline&&gsap.to(this.hoverOutline,{opacity:0,duration:.2,ease:"power2.out"})}_getHideDirection(){return"-150%"}_shouldSlideOnHide(){return!0}_setupHoverListeners(){this.items.forEach(e=>{this.isTouchDevice||(e.addEventListener("mouseenter",()=>this.onHoverStart(e)),e.addEventListener("mouseleave",()=>this.onHoverEnd())),e.addEventListener("click",e=>{if(this.isTranslating)return e.preventDefault(),e.stopPropagation(),!1},!0)}),!this.isTouchDevice&&this.container&&this.container.addEventListener("mouseleave",()=>this.onHoverEnd())}}class NavbarHighlight extends BaseHighlight{constructor(){super(),this.activeElement=null,this.lamp=null,this.navbarContainers=[],this.observer=null,this.visibleSections=new Map,this.sectionElements=[],this.sectionIdToNavLink=new Map,this._onSectionIntersect=this._onSectionIntersect.bind(this)}init(){const e=document.querySelector("nav.tubelight-nav");this.container=e,this.items=e?Array.from(e.querySelectorAll(".nav-item")):[];const t=e?.parentElement||null;this.navbarContainers=t?[t]:[],this.lamp=document.getElementById("nav-lamp"),this.hoverOutline=document.getElementById("nav-hover-outline"),this.container&&this.items.length&&this.lamp&&this.hoverOutline?(this._setupHoverListeners(),this._setupIntersectSpy(),this._initializePosition()):console.warn("NavbarHighlight: Missing required elements")}_getAnimationTargets(){return this.navbarContainers}setActive(e){e&&(this.activeElement=e,this.items.forEach(e=>e.classList.remove("active")),e.classList.add("active"),this._animateToElement(e))}updateHighlight(){if(this.activeElement){const e=this._calculatePosition(this.activeElement);gsap.set(this.lamp,{left:e.left,width:e.width,opacity:1,scaleX:1})}}destroy(){this.observer&&this.observer.disconnect()}_onSectionIntersect(e){e.forEach(e=>{this.visibleSections.set(e.target.id,{isIntersecting:e.isIntersecting,ratio:e.intersectionRatio,rect:e.boundingClientRect})}),this._updateActiveSection()}_updateActiveSection(){const e=window.innerHeight,t=.35*e;let n=null;const o=document.documentElement.scrollHeight;if((window.scrollY||window.pageYOffset)+e>=o-15)n=this.sectionElements[this.sectionElements.length-1];else for(const e of this.sectionElements){const o=this.visibleSections.get(e.id);if(!o||!o.isIntersecting||!o.rect)continue;const i=o.rect;if(i.top<=t&&i.bottom>=t){n=e;break}}if(n){const e=this.sectionIdToNavLink.get(n.id);e&&e!==this.activeElement&&this.setActive(e)}}_setupIntersectSpy(){this.observer&&this.observer.disconnect(),this.sectionElements=[],this.sectionIdToNavLink.clear();document.querySelectorAll("section[id]").forEach(e=>{const t=document.querySelector(`a[href="#${e.id}"]`);t&&(this.sectionElements.push(e),this.sectionIdToNavLink.set(e.id,t))}),this.observer=new IntersectionObserver(this._onSectionIntersect,{root:null,threshold:[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1]}),this.sectionElements.forEach(e=>this.observer.observe(e)),window.addEventListener("scroll",()=>{},{passive:!0})}_initializePosition(){const e=this.items[0];if(e&&(this.activeElement=e,e.classList.add("active"),!this.isTouchDevice)){const t=this._calculatePosition(e);gsap.set(this.lamp,{left:t.left,width:t.width,opacity:1,scaleX:1})}}_animateToElement(e,t=.4){const n=this._getAdaptiveDuration(e,t,{min:.18,max:t}),o=this._calculatePosition(e);gsap.to(this.lamp,{left:o.left,width:o.width,opacity:1,duration:n,ease:"power2.out"})}_hideHoverOutline(){gsap.to(this.hoverOutline,{opacity:0,duration:.2,ease:"power2.out"})}}const navbarHighlight=new NavbarHighlight;function initNavbar(){navbarHighlight.init(),languageHighlight.init(),heroLanguageHighlight.init()}class LanguageHighlight extends BaseHighlight{constructor(e={}){super(),this.containerId=e.containerId||"language-toggle",this.lampId=e.lampId||"lang-lamp",this.hoverOutlineId=e.hoverOutlineId||"lang-hover-outline",this.wrapper=null,this.lamp=null,this.activeElement=null}init(){this.container=document.getElementById(this.containerId),this.container&&(this.wrapper=this.container.parentElement,this.container.setAttribute("data-active-lang",LANG),this.items=Array.from(this.container.querySelectorAll(".lang-btn")),this.hoverOutline=document.getElementById(this.hoverOutlineId),this.lamp=document.getElementById(this.lampId),this.items.length&&this.hoverOutline&&this.lamp?(this._setupHoverListeners(),this._initializePosition()):console.warn("LanguageHighlight: Missing required elements"))}_getAnimationTargets(){return[this.wrapper]}_shouldSlideOnHide(){return!window.matchMedia("(max-width: 880px), (max-height: 540px)").matches}setActive(e){e&&!this.isTranslating&&(this.activeElement=e,this._animateToElement(e))}updateHighlight(){if(!this.lamp||!this.activeElement)return;const e=this._calculatePosition(this.activeElement);gsap.set(this.lamp,{left:e.left,width:e.width,opacity:1})}_initializePosition(){const e=LANG||this.container.getAttribute("data-active-lang"),t=this.container.querySelector(`[data-lang="${e}"]`);if(t){this.activeElement=t;const e=this._calculatePosition(t);gsap.set(this.lamp,{left:e.left,width:e.width,opacity:1})}}_animateToElement(e,t=.3){const n=this._getAdaptiveDuration(e,t,{min:.16,max:t}),o=this._calculatePosition(e);gsap.to(this.lamp,{left:o.left,width:o.width,opacity:1,duration:n,ease:"power2.out"})}}const languageHighlight=new LanguageHighlight,heroLanguageHighlight=new LanguageHighlight({containerId:"language-toggle-hero",lampId:"lang-lamp-hero",hoverOutlineId:"lang-hover-outline-hero"}),initThreeJS=async()=>{if(MotionPreferences.prefersReducedMotion)return;const e=document.getElementById("webgl-canvas");if(!e)return void console.error("WebGL Canvas not found!");try{"undefined"==typeof THREE&&await loadScript("./assets/vendor/three.min.js")}catch(e){return void console.error("Failed to load Three.js dynamically:",e)}if("undefined"==typeof THREE)return void console.error("Three.js is not loaded even after dynamic pull!");const t=DeviceDetector.layout,n="mobile"===t,o="tablet"===t,i="desktop"===t;let a=o?75:120;let r;r=n?45:o?50:60;const s=1e3/r;let l=0;const c=n?1.3:1,d=new THREE.Scene,u=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),m=new THREE.WebGLRenderer({canvas:e,alpha:!0,antialias:i,powerPreference:"high-performance"});let h,g;m.setClearColor(0,0),m.setPixelRatio(Math.min(window.devicePixelRatio,2)),m.setSize(window.innerWidth,window.innerHeight),u.position.z=5;const p=()=>{const e=u.fov*Math.PI/180;h=2*Math.tan(e/2)*u.position.z,g=h*u.aspect};p();const f=new Float32Array(3*a),v=[];for(let e=0;e<a;e++)f[3*e]=(Math.random()-.5)*g*2,f[3*e+1]=(Math.random()-.5)*h*2,f[3*e+2]=10*(Math.random()-.5),v.push({x:.005*(Math.random()-.5)*c,y:.005*(Math.random()-.5)*c});const y=new THREE.BufferGeometry;y.setAttribute("position",new THREE.BufferAttribute(f,3));const w=new THREE.PointsMaterial({size:.04,color:8947848,transparent:!0,opacity:.6,sizeAttenuation:!0}),b=new THREE.Points(y,w);d.add(b);const E=e=>{window.threeRafId=requestAnimationFrame(E);const t=e-l;if(t<s)return;l=e-t%s;const o=y.attributes.position,i=2*g/2,r=2*h/2;for(let e=0;e<a;e++){let t=o.getX(e),n=o.getY(e);t+=v[e].x,n+=v[e].y,t>i&&(t=-i),t<-i&&(t=i),n>r&&(n=-r),n<-r&&(n=r),o.setXYZ(e,t,n,o.getZ(e))}o.needsUpdate=!0;const c=n?2:1;b.rotation.y+=3e-4*c,b.rotation.x+=1e-4*c,m.render(d,u)};gsap.set(e,{opacity:0}),setTimeout(()=>{requestAnimationFrame(E),gsap.to(e,{opacity:1,duration:1.5,ease:"power2.inOut"})},400),window.addEventListener("resize",()=>{void 0!==m&&(u.aspect=window.innerWidth/window.innerHeight,u.updateProjectionMatrix(),m.setSize(window.innerWidth,window.innerHeight),p())})},initMobileParticles=()=>{const e=document.getElementById("webgl-canvas");if(!e)return;const t=e.getContext("2d");if(!t)return;const n=[],o=()=>{e.width=window.innerWidth,e.height=window.innerHeight};window.addEventListener("resize",o),o();for(let t=0;t<18;t++){const t=.6*Math.random()+.4;n.push({x:Math.random()*e.width,y:Math.random()*e.height,vx:.35*(Math.random()-.5)*t,vy:.35*(Math.random()-.5)*t,size:1.7*Math.random()+.8})}const i=()=>{t.clearRect(0,0,e.width,e.height),t.fillStyle="rgba(136, 136, 136, 0.4)",n.forEach(n=>{n.x+=n.vx,n.y+=n.vy,n.x<0&&(n.x=e.width),n.x>e.width&&(n.x=0),n.y<0&&(n.y=e.height),n.y>e.height&&(n.y=0),t.beginPath(),t.arc(n.x,n.y,n.size,0,2*Math.PI),t.fill()}),window.mobileRafId=requestAnimationFrame(i)};gsap.set(e,{opacity:0}),setTimeout(()=>{requestAnimationFrame(i),gsap.to(e,{opacity:1,duration:1.5,ease:"power2.inOut"})},400)},modal=document.getElementById("project-modal"),modalContent=document.getElementById("modal-content"),body=document.body;let modalLenis,modalRafId,lastFocusedElementBeforeModal=null,modalSettleTimeoutId=null,currentProjectIndex=0,currentMediaIndex=0;const totalProjects=projectsData.length;let isNavigating=!1,keyPressed={},pageScrollLockState=null;function updateModalRailOffset(){const e=document.documentElement;if(!e)return;if(!modal||!modal.classList.contains("active"))return void e.style.setProperty("--modal-rail-offset","0px");if(!(modal.scrollHeight>modal.clientHeight+1))return void e.style.setProperty("--modal-rail-offset","0px");const t=modal.offsetWidth-modal.clientWidth;e.style.setProperty("--modal-rail-offset",`${Math.max(0,t)}px`)}function lockPageScroll(){if(pageScrollLockState)return;const e=document.documentElement,t=window.innerWidth-e.clientWidth;if(pageScrollLockState={htmlOverflow:e.style.overflow,bodyOverflow:body.style.overflow,bodyPaddingRight:body.style.paddingRight},e.style.overflow="hidden",body.style.overflow="hidden",t>0){const e=LayoutCache.get(body),n=parseFloat(e?e.paddingRight:"0")||0;body.style.paddingRight=`${n+t}px`}LayoutCache.invalidate()}function unlockPageScroll(){if(!pageScrollLockState)return;document.documentElement.style.overflow=pageScrollLockState.htmlOverflow||"",body.style.overflow=pageScrollLockState.bodyOverflow||"",body.style.paddingRight=pageScrollLockState.bodyPaddingRight||"",pageScrollLockState=null,LayoutCache.invalidate()}function clearModalSettleTimer(){modalSettleTimeoutId&&(clearTimeout(modalSettleTimeoutId),modalSettleTimeoutId=null)}function markModalSettled(){modal&&modal.classList.contains("active")&&modal.classList.add("is-settled")}function unmarkModalSettled(){modal&&modal.classList.remove("is-settled")}function scheduleModalSettled(){if(!modal)return;clearModalSettleTimer(),unmarkModalSettled();modal.addEventListener("transitionend",e=>{e.target===modal&&"transform"===e.propertyName&&markModalSettled()},{once:!0}),modalSettleTimeoutId=setTimeout(()=>{modalSettleTimeoutId=null,markModalSettled()},700)}function renderMedia(e,t){return"youtube"===e.type?`\n      <div class="yt-wrapper w-full h-full">\n        <iframe\n          src="https://www.youtube.com/embed/${e.src}?autoplay=1&mute=1&loop=1&playlist=${e.src}&playsinline=1&controls=1&modestbranding=1&rel=0"\n          class="yt-iframe w-full h-full cursor-hide"\n          frameborder="0"\n          allow="autoplay; encrypted-media"\n          allowfullscreen\n        ></iframe>\n      </div>\n    `:"vimeo"===e.type?`\n      <div class="vimeo-wrapper w-full h-full">\n        <iframe\n          src="https://player.vimeo.com/video/${e.src}?autoplay=1&muted=1&loop=1&playsinline=1"\n          class="vimeo-iframe w-full h-full cursor-hide"\n          frameborder="0"\n          allow="autoplay; fullscreen"\n          allowfullscreen\n        ></iframe>\n      </div>\n    `:`<img src="${e.src}" class="w-full h-full object-cover" alt="${t}" loading="lazy">`}function initVideoTouchInteractivity(){if(!DeviceDetector.isTouchDevice)return;document.querySelectorAll("#media-container .yt-wrapper, #media-container .vimeo-wrapper").forEach(e=>{"true"!==e.dataset.videoTouchBound&&(e.addEventListener("touchstart",()=>{e.classList.add("interacting")},{passive:!0}),e.dataset.videoTouchBound="true")})}function updateMediaDots(){document.querySelectorAll(".media-dot").forEach((e,t)=>{t===currentMediaIndex?e.classList.add("is-active"):e.classList.remove("is-active")})}function initMediaSwipe(){const e=document.getElementById("media-container");if(!e)return;let t=0,n=0,o=0,i=0;e.addEventListener("touchstart",e=>{t=e.changedTouches[0].screenX,o=e.changedTouches[0].screenY},{passive:!0}),e.addEventListener("touchend",e=>{n=e.changedTouches[0].screenX,i=e.changedTouches[0].screenY,function(){const e=t-n,a=Math.abs(o-i);Math.abs(e)>50&&Math.abs(e)>a&&(e>0?navigateMedia(1):navigateMedia(-1))}()},{passive:!0})}function renderModalContent(e){const t=projectsData[e];currentMediaIndex=0,modalContent.innerHTML=`\n        ${_renderModalHeader(t,e)}\n        ${_renderModalMediaSection(t,e)}\n        <div class="grid grid-cols-1 md:grid-cols-3 gap-12">\n            <div class="md:col-span-2">\n                ${_renderModalDescription(t,e)}\n                ${_renderModalFeatures(t,e)}\n                ${_renderModalCodeSnippet(t)}\n            </div>\n            <div class="md:col-span-1">\n                ${_renderModalTechStack(t)}\n            </div>\n        </div>\n    `,"undefined"!=typeof lucide&&lucide.createIcons(),t.media.length>1&&DeviceDetector.isTouchDevice&&initMediaSwipe(),"undefined"!=typeof Prism&&Prism.highlightAllUnder(modalContent),initPulseAnimations(),bindProjectCTAAnalytics(),requestCursorSync()}function _renderModalHeader(e,t){let n="";if(e.badges&&e.badges.length){const t=LANG||"en";n=`\n            <div class="flex flex-wrap items-center gap-2 mt-3">\n                ${e.badges.map((n,o)=>{const i=e&&"Tape Us Out"===e.title;let a="";if(n&&"object"==typeof n?a=n[t]||n.en||"":"string"==typeof n&&(a=n.trim()),!a)return"";let r="inline-flex items-center gap-2 rounded-full border px-3 py-1 text-[11px] md:text-xs font-mono text-muted tracking-tight bg-white/5 border-white/15",s="inline-block h-1.5 w-1.5 rounded-full bg-emerald-400";return i&&0===o&&(r+=" border-emerald-400/70 bg-emerald-500/10 text-emerald-100",s="inline-block h-1.5 w-1.5 rounded-full bg-emerald-400 shadow-[0_0_0_1px_rgba(16,185,129,0.7)]"),`<span class="${r}">\n                            <span class="${s}"></span>\n                            <span>${a}</span>\n                        </span>`}).join("")}\n            </div>\n        `}return`\n        <div class="mb-12 animate-fade-in">\n            <div class="text-sm font-mono text-muted mb-2">${TRANSLATIONS.modal_project_index||"PROJECT"}_0${t+1}</div>\n            <h1 class="text-4xl md:text-6xl lg:text-7xl font-bold mb-6 leading-tight text-white">${e.title}</h1>\n            ${n}\n        </div>\n    `}function _renderModalMediaSection(e,t){return`\n        <div class="w-full mb-6">\n            <div class="modal-media-wrapper relative w-full aspect-video rounded-3xl border border-white/10 shadow-2xl bg-black/50 overflow-hidden">\n                <div id="media-container" class="relative w-full h-full rounded-3xl overflow-hidden">\n                    <div class="media-inner w-full h-full">\n                        ${renderMedia(e.media[0],e.title)}\n                    </div>\n                    ${e.media.length>1?'\n                    \x3c!-- Desktop: overlay media navigation (controlled via CSS media queries) --\x3e\n                    <div class="media-overlay-layer">\n                        <button onclick="navigateMedia(-1)" class="media-overlay-btn media-overlay-btn--prev" aria-label="Previous media">\n                            <i data-lucide="chevron-left" class="w-5 h-5 md:w-6 md:h-6"></i>\n                        </button>\n                        <button onclick="navigateMedia(1)" class="media-overlay-btn media-overlay-btn--next" aria-label="Next media">\n                            <i data-lucide="chevron-right" class="w-5 h-5 md:w-6 md:h-6"></i>\n                        </button>\n                    </div>\n                    ':""}\n                </div>\n            </div>\n            ${e.media.length>1?`\n            <div class="media-controls flex items-center justify-center gap-4 mt-4">\n                \x3c!-- Touch / non-desktop: arrows live in the bottom bar --\x3e\n                <button onclick="navigateMedia(-1)" class="media-nav-btn media-bottom-nav-btn flex items-center justify-center" aria-label="Previous media">\n                    <i data-lucide="chevron-left" class="w-5 h-5 md:w-6 md:h-6"></i>\n                </button>\n                <div class="flex items-center justify-center gap-2">\n                    ${e.media.map((e,t)=>`\n                        <button onclick="goToMedia(${t})" class="media-dot ${0===t?"is-active":""}" aria-label="Go to media ${t+1}"></button>\n                    `).join("")}\n                </div>\n                <button onclick="navigateMedia(1)" class="media-nav-btn media-bottom-nav-btn flex items-center justify-center" aria-label="Next media">\n                    <i data-lucide="chevron-right" class="w-5 h-5 md:w-6 md:h-6"></i>\n                </button>\n            </div>\n            `:""}\n        </div>\n    `}function _renderModalDescription(e,t){return`\n        <p class="text-muted leading-relaxed text-lg mb-8">${TRANSLATIONS["project"+(t+1)+"_description"]||e.description[LANG]||e.description.en}</p>\n        <h2 class="text-2xl font-bold mb-4 text-white">${TRANSLATIONS.modal_challenge||"The Challenge"}</h2>\n        <p class="text-muted leading-relaxed text-lg mb-8">${TRANSLATIONS["project"+(t+1)+"_challenge"]||""}</p>\n    `}function _renderModalFeatures(e,t){return`\n        <h2 class="text-2xl font-bold mb-4 text-white">${TRANSLATIONS.modal_features||"Key Features"}</h2>\n        <ul class="space-y-3 mb-8">\n            ${(TRANSLATIONS["project"+(t+1)+"_features"]||e.features[LANG]||e.features.en).map(e=>`<li class="flex items-center gap-3 text-gray-300"><i data-lucide="check-circle" class="w-5 h-5 shrink-0 text-white"></i> ${e}</li>`).join("")}\n        </ul>\n    `}function _escapeHtml(e){return String(e).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function _renderModalCodeSnippet(e){const t=_escapeHtml(`${`/// <summary>\n/// ${TRANSLATIONS.code_snippet_disclaimer_summary||"Illustrative example inspired by a real system from this project."}\n/// </summary>\n/// <remarks>\n/// ${TRANSLATIONS.code_snippet_disclaimer_remarks||"Not a literal source file. Intentionally simplified to show how I would structure this today (names and details reduced)."}\n/// </remarks>\n\n`}${e.codeSnippet||""}`);return`\n        \x3c!-- CodeSnap Style Container --\x3e\n        <div class="rounded-xl overflow-hidden bg-[#1e1e1e] shadow-2xl border border-white/5 group/code">\n            \x3c!-- Window Header --\x3e\n            <div class="flex items-center gap-2 px-4 py-3 bg-white/5 border-b border-white/5">\n                <div class="w-3 h-3 rounded-full bg-[#ff5f56]"></div>\n                <div class="w-3 h-3 rounded-full bg-[#ffbd2e]"></div>\n                <div class="w-3 h-3 rounded-full bg-[#27c93f]"></div>\n            </div>\n            \x3c!-- Code Content --\x3e\n            <div class="p-6 overflow-x-auto">\n                <pre class="!bg-transparent !m-0 !p-0"><code class="language-${e.language||"clike"} font-mono text-sm leading-relaxed">${t}</code></pre>\n            </div>\n        </div>\n    `}function _renderModalTechStack(e){const t=e&&"Tape Us Out"===e.title,n=e&&"Idle Journey"===e.title,o=t?"steam":n?"browser":"itch";let i,a;"steam"===o?(i="modal_view_steam",a="View on Steam"):"browser"===o?(i="modal_play_browser",a="Play in Browser"):(i="modal_view_itch",a="View on itch.io");const r=TRANSLATIONS[i]||a;let s,l;if(s="steam"===o?"bg-gradient-to-r from-[#1f2937] via-[#334155] to-[#3b82f6] text-white border-[#66c0f4]/70 shadow-[0_0_22px_rgba(37,99,235,0.75)]":"browser"===o?"bg-gradient-to-r from-[#1e3a8a] via-[#2563eb] to-[#0ea5e9] text-white border-[#38bdf8]/70 shadow-[0_0_22px_rgba(30,64,175,0.75)]":"bg-gradient-to-r from-[#b91c1c] via-[#e11d48] to-[#fb923c] text-white border-[#fb7185]/70 shadow-[0_0_22px_rgba(185,28,28,0.75)]","steam"===o){l=`<img src="${"https://cdn.simpleicons.org/steam/ffffff"}" alt="Steam logo" class="w-4 h-4 md:w-5 md:h-5 object-contain" loading="lazy" />`}else if("browser"===o)l='<i data-lucide="globe-2" class="w-4 h-4 md:w-5 md:h-5 text-white"></i>';else{l=`<img src="${"https://cdn.simpleicons.org/itchdotio/ffffff"}" alt="itch.io logo" class="w-4 h-4 md:w-5 md:h-5 object-contain" loading="lazy" />`}let c="https://github.com/marciorosendo";if(e&&e.links){const t=e.links;"steam"===o&&t.steam?c=t.steam:"itch"===o&&t.itch?c=t.itch:t.repo?c=t.repo:t.play?c=t.play:t.demo&&(c=t.demo)}const d=o;return`\n        <div class="sticky top-12 p-6 rounded-2xl border border-white/10 bg-white/5 backdrop-blur">\n            <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400 mb-4">${TRANSLATIONS.modal_stack||"Tech Stack"}</h3>\n            <div class="flex flex-wrap gap-2 mb-8">\n                ${e.stack.map(e=>`<span class="px-3 py-1 bg-black rounded-lg border border-white/10 text-xs text-white font-mono">${e}</span>`).join("")}\n            </div>\n            <button\n              class="pulse-btn w-full py-3 font-bold rounded-lg transition-colors flex items-center justify-center gap-2 border ${s}"\n              style=""\n              type="button"\n              data-project-cta="primary"\n              data-project-title="${e.title}"\n              data-project-destination="${d}"\n              data-project-url="${c}"\n            >\n              ${l}\n              <span>${r}</span>\n            </button>\n        </div>\n    `}function bindProjectCTAAnalytics(){const e=document.querySelector("#project-modal [data-project-cta='primary']");if(!e)return;const t=e.dataset.projectTitle||"Unknown Project",n=e.dataset.projectDestination||"unknown",o=e.dataset.projectUrl||e.href;e.removeEventListener("click",e._gaClickHandler||(()=>{}));const i=()=>{trackEvent("project_outbound_click",{event_category:"projects",event_label:t,destination_type:n,destination:o}),o&&window.open(o,"_blank","noopener,noreferrer")};e._gaClickHandler=i,e.addEventListener("click",i)}function getModalFocusableElements(){const e=[];modal&&e.push(...modal.querySelectorAll('a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])'));return[document.getElementById("modal-close-btn"),document.getElementById("modal-prev-btn"),document.getElementById("modal-next-btn")].forEach(t=>{t&&e.push(t)}),Array.from(new Set(e)).filter(e=>!e.hasAttribute("disabled"))}function handleModalFocusTrap(e){if(!modal||!modal.classList.contains("active"))return;if("Tab"!==e.key)return;const t=getModalFocusableElements();if(!t.length)return;const n=t[0],o=t[t.length-1],i=document.activeElement,a=!t.includes(i);e.shiftKey?(i===n||a)&&(e.preventDefault(),o.focus()):(i===o||a)&&(e.preventDefault(),n.focus())}function openProject(e){if(currentProjectIndex=e,!modalContent)return;if(isNavigating=!1,keyPressed={},lastFocusedElementBeforeModal=document.activeElement,renderModalContent(e),loadProjectPrism().then(()=>{window.Prism&&modalContent&&Prism.highlightAllUnder(modalContent)}),modal){modal.scrollTop=0;const e=document.getElementById("modal-scroll-container");e&&(e.scrollTop=0),unmarkModalSettled(),modal.classList.add("active"),modal.setAttribute("aria-hidden","false"),scheduleModalSettled()}requestAnimationFrame(()=>{updateModalRailOffset()});const t=document.getElementById("modal-close-btn"),n=document.getElementById("modal-prev-btn"),o=document.getElementById("modal-next-btn");t&&(t.tabIndex=0,t.classList.remove("opacity-0","pointer-events-none")),n&&(n.tabIndex=0,n.classList.remove("opacity-0","pointer-events-none")),o&&(o.tabIndex=0,o.classList.remove("opacity-0","pointer-events-none"));const i=getModalFocusableElements();if(i.length){let e=null;const t=modalContent.querySelector("h1");if(t)t.hasAttribute("tabindex")||t.setAttribute("tabindex","-1"),e=t;else{const t=document.getElementById("modal-close-btn");e=t&&i.includes(t)?t:i[0]}e.focus()}document.addEventListener("keydown",handleModalFocusTrap),window.scrollManager&&window.scrollManager.pauseForModal(),lockPageScroll();"tablet"===DeviceDetector.layout?gsap.set("#modal-content > div",{opacity:1,y:0}):gsap.from("#modal-content > div",{y:50,opacity:0,duration:.6,stagger:.1,ease:"power3.out"})}function navigateProject(e){if(isNavigating)return;isNavigating=!0;const t=document.getElementById("modal-prev-btn"),n=document.getElementById("modal-next-btn");t&&(t.style.pointerEvents="none",t.style.opacity="0.5"),n&&(n.style.pointerEvents="none",n.style.opacity="0.5"),currentProjectIndex=(currentProjectIndex+e+totalProjects)%totalProjects,modalContent.classList.add("transitioning"),setTimeout(()=>{renderModalContent(currentProjectIndex);const e=document.getElementById("modal-scroll-container");e&&(e.scrollTop=0),setTimeout(()=>{modalContent.classList.remove("transitioning"),updateModalRailOffset();"tablet"===DeviceDetector.layout?gsap.set("#modal-content > div",{opacity:1,y:0}):gsap.from("#modal-content > div",{y:30,opacity:0,duration:.4,stagger:.08,ease:"power2.out"}),t&&(t.style.pointerEvents="",t.style.opacity=""),n&&(n.style.pointerEvents="",n.style.opacity=""),isNavigating=!1},50)},300)}function closeProject(){isNavigating=!1,keyPressed={},modal&&(clearModalSettleTimer(),modal.classList.contains("is-settled")&&(unmarkModalSettled(),modal.offsetHeight),modal.classList.remove("active"),modal.setAttribute("aria-hidden","true")),updateModalRailOffset();const e=document.getElementById("modal-close-btn"),t=document.getElementById("modal-prev-btn"),n=document.getElementById("modal-next-btn");e&&(e.tabIndex=-1,e.classList.add("opacity-0","pointer-events-none")),t&&(t.tabIndex=-1,t.classList.add("opacity-0","pointer-events-none")),n&&(n.tabIndex=-1,n.classList.add("opacity-0","pointer-events-none")),window.scrollManager&&window.scrollManager.resumeAfterModal(),body.style.overflow="",unlockPageScroll(),document.removeEventListener("keydown",handleModalFocusTrap),lastFocusedElementBeforeModal&&"function"==typeof lastFocusedElementBeforeModal.focus&&lastFocusedElementBeforeModal.focus(),lastFocusedElementBeforeModal=null,requestCursorSync()}function requestCursorSync(){"undefined"!=typeof document&&document.dispatchEvent(new CustomEvent("cursor:sync"))}function initCursor(){const e=document.getElementById("cursor");if(!e)return void console.warn("Cursor element not found in DOM");if(!!DeviceDetector.isTouchDevice)return void(e.style.display="none");const t=document.querySelectorAll(".spotlight-card");let n=0,o=0,i=!1,a=!1,r=!1;function s(){e.style.left=n+"px",e.style.top=o+"px",t.forEach(e=>{const t=LayoutCache.get(e);if(t&&n>=t.left&&n<=t.left+t.width&&o>=t.top&&o<=t.top+t.height){const i=n-t.left,a=o-t.top;e.style.setProperty("--mouse-x",`${i}px`),e.style.setProperty("--mouse-y",`${a}px`)}}),r&&(a=!1,r=!1,e.style.opacity="1"),d(),i=!1}document.addEventListener("mousemove",e=>{n=e.clientX,o=e.clientY,i||(i=!0,requestAnimationFrame(s))});const l=["a[href]","button",'[role="button"]','input[type="submit"]','input[type="button"]',"[onclick]",".hover-trigger"].join(", "),c=e=>!!e&&(e.matches("input, textarea, .cursor-hide")||!!e.closest("input, textarea, .cursor-hide")),d=()=>{const t=document.elementFromPoint(n,o);return c(t)||(()=>{const e=document.documentElement;if(modal&&modal.classList.contains("active")){const e=modal.offsetWidth-modal.clientWidth;if(e>0){const t=modal.getBoundingClientRect(),i=t.right-e;if(n>=i&&n<=t.right&&o>=t.top&&o<=t.bottom)return!0}}const t=window.innerWidth-e.clientWidth;if(t>0){const e=window.innerWidth-t;if(n>=e)return!0}return!1})()?(e.style.opacity="0",a=!0,r=!1,void e.classList.remove("hovered")):a?(r=!0,e.style.opacity="0",void e.classList.remove("hovered")):(e.style.opacity="1",void(t&&t.closest(l)?e.classList.add("hovered"):e.classList.remove("hovered")))};document.addEventListener("cursor:sync",()=>{requestAnimationFrame(d)}),document.body.addEventListener("mouseover",t=>{if(c(t.target))return e.style.opacity="0",a=!0,void(r=!1);t.target.closest(l)&&e.classList.add("hovered")}),document.body.addEventListener("mouseout",t=>{if(c(t.target))return e.style.opacity="1",a=!1,void(r=!1);t.target.closest(l)&&e.classList.remove("hovered")})}function initInteractiveEffects(){if(MotionPreferences.prefersReducedMotion)return;const e=!DeviceDetector.isTouchDevice,t=DeviceDetector.isTablet;if(!e||t)return;document.querySelectorAll(".spotlight-card").forEach(e=>{e.addEventListener("mousemove",t=>{const n=LayoutCache.get(e);if(!n)return;const o=t.clientX-n.left,i=t.clientY-n.top;e.style.setProperty("--mouse-x",`${o}px`),e.style.setProperty("--mouse-y",`${i}px`);const a=n.width/2,r=n.height/2,s=(i-r)/r*-5,l=(o-a)/a*5;gsap.to(e,{transform:`perspective(1000px) rotateX(${s}deg) rotateY(${l}deg) scale3d(1, 1, 1)`,duration:.4,ease:"power2.out"})}),e.addEventListener("mouseleave",()=>{gsap.to(e,{transform:"perspective(1000px) rotateX(0deg) rotateY(0deg) scale3d(1, 1, 1)",duration:.6,ease:"elastic.out(1, 0.5)"})})});document.querySelectorAll(".magnetic-btn").forEach(e=>{e.addEventListener("mousemove",t=>{const n=e.getBoundingClientRect(),o=t.clientX-n.left-n.width/2,i=t.clientY-n.top-n.height/2;gsap.to(e,{x:.3*o,y:.3*i,duration:.3,ease:"power2.out"})}),e.addEventListener("mouseleave",()=>{gsap.to(e,{x:0})})})}function initPulseAnimations(){if(MotionPreferences.prefersReducedMotion)return;if(!!DeviceDetector.isTouchDevice)return;document.querySelectorAll(".pulse-btn, button:not(.modal-nav-btn):not(#modal-close-btn):not(.lang-btn):not(.js-lang-btn), a.js-smooth-scroll").forEach(e=>{let t=!1,n=!1;function o(){n=!0,e.classList.add("pulse-active"),setTimeout(()=>{e.classList.remove("pulse-active"),n=!1,t&&setTimeout(()=>{t&&o()},50)},1200)}e.addEventListener("mouseenter",function(){t=!0,n||o()}),e.addEventListener("mouseleave",function(){t=!1})})}function initTimelineAnimation(){if(MotionPreferences.prefersReducedMotion)return;document.getElementById("timeline")&&"undefined"!=typeof gsap&&(gsap.registerPlugin(ScrollTrigger),void 0===window.__timelineAnimationHasPlayed&&(window.__timelineAnimationHasPlayed=!1),ScrollTrigger.matchMedia({"(min-width: 1024px)":function(){const e=document.getElementById("timeline-desktop");if(!e)return;const t=Array.from(e.querySelectorAll(".timeline-dot")),n=Array.from(e.querySelectorAll(".timeline-line")),o=Array.from(e.querySelectorAll(".group")),i=(Array.from(e.querySelectorAll(".col-start-2 .flex, .col-start-3 .flex")).filter(e=>!e.closest(".group")),Array.from(e.querySelectorAll(".col-start-1 .flex, .col-start-2 .flex, .col-start-3 .flex")).filter(e=>!e.closest(".group")));if(window.__timelineAnimationHasPlayed)return gsap.set(t,{opacity:1,scale:1,clearProps:"transform"}),gsap.set(n,{scaleY:1,opacity:1,clearProps:"transform"}),gsap.set(o,{opacity:1,x:0,clearProps:"all"}),void gsap.set(i,{opacity:1,x:0,clearProps:"all"});gsap.set(t,{opacity:0,scale:0}),gsap.set(n,{scaleY:0,opacity:0,transformOrigin:"top center"}),gsap.set(o,{opacity:0,x:-20}),gsap.set(i,{opacity:0,x:20});const a=gsap.timeline({scrollTrigger:{trigger:e,start:"top 75%",toggleActions:"play none none none",once:!0},onComplete:()=>{window.__timelineAnimationHasPlayed=!0}});t.forEach((e,t)=>{const r=n[t],s=o[t],l=i[t],c=0===t?0:">-0.1";a.to(e,{opacity:1,scale:1,duration:.4,ease:"back.out(2)",clearProps:"transform"},c),s&&a.to(s,{opacity:1,x:0,duration:.4,ease:"power2.out"},"<+=0.1"),l&&a.to(l,{opacity:1,x:0,duration:.4,ease:"power2.out"},"<+=0.1"),r&&a.to(r,{scaleY:1,opacity:1,duration:.3,ease:"none"},">")});const r=e=>{if(t.forEach(e=>e.classList.remove("is-active")),e<0)return;const n=t[e];n&&n.classList.add("is-active")},s=(e,t)=>{e&&!e.dataset.timelineHoverBound&&(e.dataset.timelineHoverBound="true",e.addEventListener("mouseenter",()=>r(t)),e.addEventListener("mouseleave",()=>r(-1)))};o.forEach((e,t)=>s(e,t)),i.forEach((e,t)=>s(e,t))},"(max-width: 1023px)":function(){const e=document.getElementById("timeline-mobile");if(!e)return;const t=Array.from(e.querySelectorAll(".timeline-dot")),n=Array.from(e.querySelectorAll(".timeline-line")),o=Array.from(e.querySelectorAll(".timeline-content")),i=Array.from(e.querySelectorAll(".timeline-tags"));if(window.__timelineAnimationHasPlayed)return gsap.set(t,{opacity:1,scale:1,clearProps:"transform"}),gsap.set(n,{scaleY:1,opacity:1,clearProps:"transform"}),gsap.set(o,{opacity:1,x:0,clearProps:"all"}),void gsap.set(i,{opacity:1,x:0,clearProps:"all"});gsap.set(t,{opacity:0,scale:0}),gsap.set(n,{scaleY:0,opacity:0,transformOrigin:"top center"}),gsap.set(o,{opacity:0,x:-20}),gsap.set(i,{opacity:0,x:20});const a=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting&&!window.__timelineAnimationHasPlayed){const e=gsap.timeline({onComplete:()=>{window.__timelineAnimationHasPlayed=!0,a.disconnect()}});t.forEach((t,a)=>{const r=n[a],s=o[a],l=i[a],c=0===a?0:">-0.1";e.to(t,{opacity:1,scale:1,duration:.4,ease:"back.out(2)",clearProps:"transform"},c),s&&e.to(s,{opacity:1,x:0,duration:.4,ease:"power2.out"},"<+=0.1"),l&&e.to(l,{opacity:1,x:0,duration:.4,ease:"power2.out"},"<+=0.1"),r&&e.to(r,{scaleY:1,opacity:1,duration:.3,ease:"none"},">")})}})},{threshold:.05,rootMargin:"0px 0px -50px 0px"});a.observe(e)}}))}window.addEventListener("resize",()=>{requestAnimationFrame(updateModalRailOffset)}),window.navigateMedia=function(e){const t=projectsData[currentProjectIndex];currentMediaIndex=(currentMediaIndex+e+t.media.length)%t.media.length;const n=document.querySelector("#media-container .media-inner");n&&(n.innerHTML=renderMedia(t.media[currentMediaIndex],t.title)),updateMediaDots(),"undefined"!=typeof lucide&&lucide.createIcons(),initVideoTouchInteractivity(),requestCursorSync()},window.goToMedia=function(e){currentMediaIndex=e;const t=projectsData[currentProjectIndex],n=document.querySelector("#media-container .media-inner");n&&(n.innerHTML=renderMedia(t.media[currentMediaIndex],t.title)),updateMediaDots(),initVideoTouchInteractivity(),requestCursorSync()},document.addEventListener("keydown",e=>{if(modal.classList.contains("active"))switch(e.key){case"Escape":e.preventDefault(),closeProject();break;case"ArrowLeft":e.preventDefault(),keyPressed.ArrowLeft||isNavigating||(keyPressed.ArrowLeft=!0,navigateProject(-1));break;case"ArrowRight":e.preventDefault(),keyPressed.ArrowRight||isNavigating||(keyPressed.ArrowRight=!0,navigateProject(1))}}),document.addEventListener("keyup",e=>{"ArrowLeft"!==e.key&&"ArrowRight"!==e.key||(keyPressed[e.key]=!1)}),window.addEventListener("blur",()=>{keyPressed={}});let marqueeTimeline=null,marqueeResizeObserver=null,marqueeRefreshRaf=null;function initMarquee(){const e=document.querySelector(".marquee-container");if(!e)return;marqueeTimeline&&(marqueeTimeline.kill(),marqueeTimeline=null),marqueeResizeObserver&&(marqueeResizeObserver.disconnect(),marqueeResizeObserver=null),marqueeRefreshRaf&&(cancelAnimationFrame(marqueeRefreshRaf),marqueeRefreshRaf=null),e.innerHTML="";const t=MotionPreferences.prefersReducedMotion;t&&e.classList.add("flex-wrap","justify-center");const n=[{name:"Photon",icon:"zap"},{name:"DOTween",icon:"activity"},{name:"ScriptableObjects",icon:"layers"},{name:"Cinemachine",icon:"video"},{name:"Animator",icon:"sparkles"},{name:"NavMesh",icon:"map"},{name:"Physics",icon:"atom"},{name:"UnityEditor",icon:"wrench"}],o=e=>{const t=document.createElement("div");return t.className="flex items-center gap-2 md:gap-3 px-4 py-2 md:px-11 md:py-3 bg-gradient-to-b from-white/10 to-white/5 border border-white/20 rounded-full shrink-0 shadow-md md:shadow-lg hover:border-white/40 transition-colors duration-300 pointer-events-none select-none",t.innerHTML=`\n      <i data-lucide="${e.icon}" class="w-4 h-4 md:w-6 md:h-6 text-white drop-shadow-md"></i>\n      <span class="text-sm md:text-lg font-mono text-white font-bold tracking-wide drop-shadow-sm">${e.name}</span>\n    `,t};for(let i=0;i<(t?1:2);i++)n.forEach(t=>e.appendChild(o(t)));if(e.dataset.marqueeSets=String(t?1:2),"undefined"!=typeof lucide&&lucide.createIcons(),t)return;const i=()=>{if("undefined"==typeof gsap)return;gsap.set(e,{x:0}),e.offsetHeight;const t=Array.from(e.children),a=n.length;if(t.length<2*a)return;const r=t[0],s=t[a],l=Math.round(s.getBoundingClientRect().left-r.getBoundingClientRect().left);if(!Number.isFinite(l)||l<=0)return;const c=Math.round((e.parentElement?.getBoundingClientRect().width??window.innerWidth)||window.innerWidth),d=Math.max(2,Math.ceil(c/l)+1),u=Number(e.dataset.marqueeSets)||2;if(d>u){for(let t=u;t<d;t++)n.forEach(t=>e.appendChild(o(t)));return e.dataset.marqueeSets=String(d),"undefined"!=typeof lucide&&lucide.createIcons(),void requestAnimationFrame(i)}const m=Math.max(8,l/80);marqueeTimeline&&(marqueeTimeline.kill(),marqueeTimeline=null),marqueeTimeline=gsap.to(e,{x:`-=${l}`,duration:m,ease:"none",repeat:-1,modifiers:{x:e=>`${(parseFloat(e)||0)%l}px`}});const h=e.closest("section");if(h){if(DeviceDetector.isMobile){new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting?marqueeTimeline.play():marqueeTimeline.pause()})},{threshold:0,rootMargin:"0px"}).observe(h)}else"undefined"!=typeof ScrollTrigger&&ScrollTrigger.create({trigger:h,start:"top bottom",end:"bottom top",onEnter:()=>marqueeTimeline.play(),onLeave:()=>marqueeTimeline.pause(),onEnterBack:()=>marqueeTimeline.play(),onLeaveBack:()=>marqueeTimeline.pause()})}};document.fonts&&document.fonts.ready?document.fonts.ready.then(()=>{requestAnimationFrame(()=>{requestAnimationFrame(i)})}):requestAnimationFrame(()=>{requestAnimationFrame(i)}),"undefined"!=typeof ResizeObserver?(marqueeResizeObserver=new ResizeObserver(()=>{marqueeRefreshRaf&&cancelAnimationFrame(marqueeRefreshRaf),marqueeRefreshRaf=requestAnimationFrame(()=>{marqueeRefreshRaf=null,i()})}),marqueeResizeObserver.observe(e)):window.addEventListener("resize",()=>{marqueeRefreshRaf&&cancelAnimationFrame(marqueeRefreshRaf),marqueeRefreshRaf=requestAnimationFrame(()=>{marqueeRefreshRaf=null,i()})},{passive:!0})}class ScrollManager{constructor(){this.lenis=null,this.rafId=null}init(){if(MotionPreferences.prefersReducedMotion)document.documentElement.style.scrollBehavior="auto";else{if("undefined"==typeof Lenis)return console.warn("Lenis not loaded, falling back to native scroll."),void(document.documentElement.style.scrollBehavior="smooth");this._initLenis(),this._setupScrollbarFix(),this._setupAnchorLinks()}}_initLenis(){if(this.lenis)return;if(DeviceDetector.isTouchDevice||"mobile"===DeviceDetector.layout)return document.documentElement.style.scrollBehavior="smooth",this.lenis=null,void(window.lenis=null);this.lenis=new Lenis({duration:1,easing:e=>Math.min(1,1.001-Math.pow(2,-10*e)),smoothWheel:!0,syncTouch:!1,autoResize:!0,orientation:"vertical"}),window.lenis=this.lenis;const e=t=>{this.lenis&&(this.lenis.raf(t),this.rafId=requestAnimationFrame(e))};this.rafId=requestAnimationFrame(e)}_setupScrollbarFix(){window.addEventListener("mousedown",e=>{window.innerWidth-document.documentElement.clientWidth>0&&e.clientX>=document.documentElement.clientWidth&&this.lenis&&this.lenis.scrollTo(window.scrollY,{immediate:!0})})}pauseForModal(){this.lenis&&"function"==typeof this.lenis.destroy&&this.lenis.destroy(),this.lenis=null,this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null),window.lenis=null}resumeAfterModal(){this._initLenis()}_setupAnchorLinks(){document.querySelectorAll(".nav-item, .js-smooth-scroll").forEach(e=>{e.addEventListener("click",t=>{const n=e.getAttribute("href");if(!n||!n.startsWith("#"))return;const o=document.querySelector(n);if(!o)return;t.preventDefault();const i=DeviceDetector.isTouchDevice,a=LayoutCache.get(o);if(!a)return;const r=window.innerHeight||document.documentElement.clientHeight,s=window.scrollY||window.pageYOffset||document.documentElement.scrollTop||0,l=document.querySelector("nav.tubelight-nav"),c=l&&LayoutCache.get(l)?.offsetHeight||0;let d;if(a.height<r){d=s+a.top+a.height/2-r/2}else{const e=.05*r;d=s+a.top-c-e}this.lenis&&!i?this.lenis.scrollTo(d,{duration:1.5,easing:e=>Math.min(1,1.001-Math.pow(2,-10*e))}):window.scrollTo({top:d,behavior:"smooth"})})})}}function initCVDownload(){const e=[],t=document.getElementById("header-cv-btn");t&&e.push({element:t,label:"header_cv_button"});const n=document.getElementById("hero-cv-btn");n&&e.push({element:n,label:"hero_cv_button"});const o=document.getElementById("download-cv-btn");o&&e.push({element:o,label:"about_cv_card"}),e.length&&e.forEach(({element:e,label:t})=>{e.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();const n=(localStorage.getItem("lang")||"en").toLowerCase(),o="pt-br"===n?"MarcioRosendoResumePtbr.pdf":"MarcioRosendoResumeEn.pdf";showToast("toast_cv_downloading","info"),trackEvent("cv_download",{event_category:"engagement",event_label:t,lang:n});const i=document.createElement("a");i.href=o,i.download=o,document.body.appendChild(i),i.click(),document.body.removeChild(i)})})}function initScrollAnimations(){if(MotionPreferences.prefersReducedMotion)return void document.querySelectorAll(".fade-in-section").forEach(e=>{e.classList.add("is-visible")});const e=new IntersectionObserver((e,t)=>{e.forEach(e=>{e.isIntersecting&&(e.target.classList.add("is-visible"),t.unobserve(e.target))})},{root:null,rootMargin:"0px",threshold:.1});document.querySelectorAll(".fade-in-section").forEach(t=>{e.observe(t)})}function initProjectCardsAccessibility(){const e=document.querySelectorAll(".accordion-card[data-project-index]");e.length&&e.forEach(e=>{e.addEventListener("keydown",t=>{if("Enter"===t.key||" "===t.key){t.preventDefault();const n=parseInt(e.dataset.projectIndex,10);Number.isNaN(n)||openProject(n)}})})}const CONTACT_MIN_SUBMIT_MS=900;function initContactForm(){const e=document.getElementById("contact-form");e&&(e.action||(e.action=getFormSubmitAction()),e.addEventListener("submit",handleContactSubmit))}async function handleContactSubmit(e){e.preventDefault();const t=e.target,n=document.getElementById("contact-submit-btn");if(!n)return;const o=n.querySelector(".btn-text");if(!o)return;n.disabled=!0,n.classList.add("cursor-not-allowed","opacity-80","is-sending"),o.setAttribute("data-translate","contact_btn_sending");const i="contact_btn_sending";TRANSLATIONS[i]?o.textContent=TRANSLATIONS[i]:o.textContent="Transmitting...";try{const e=new FormData(t),i=performance.now();let a;try{a=await fetch(t.action,{method:"POST",body:e,headers:{Accept:"application/json"}})}catch(e){const t=performance.now()-i;throw t<900&&await new Promise(e=>setTimeout(e,900-t)),e}const r=performance.now()-i;if(r<900&&await new Promise(e=>setTimeout(e,900-r)),!a.ok)throw new Error("Form submission failed");{trackEvent("contact_submit",{event_category:"engagement",event_label:"contact_form",status:"success"}),t.reset(),n.classList.remove("is-sending"),n.classList.add("is-success"),o.setAttribute("data-translate","contact_btn_success");const e="contact_btn_success";TRANSLATIONS[e]?o.textContent=TRANSLATIONS[e]:o.textContent="Transmitted!";const i=document.getElementById("contact-success");i&&(i.classList.remove("hidden"),requestAnimationFrame(()=>{i.classList.remove("opacity-0"),i.classList.add("opacity-100")})),showToast("contact_success_message","success"),setTimeout(()=>{n.classList.remove("is-success"),n.disabled=!1,n.classList.remove("cursor-not-allowed","opacity-80"),o.setAttribute("data-translate","contact_btn_send");const e="contact_btn_send";TRANSLATIONS[e]?o.textContent=TRANSLATIONS[e]:o.textContent="Send Message"},1800)}}catch(e){console.error("Error submitting form:",e),trackEvent("contact_submit",{event_category:"engagement",event_label:"contact_form",status:"error"}),alert("Connection Error. Please try again or email directly."),n.disabled=!1,n.classList.remove("cursor-not-allowed","opacity-80","is-sending","is-success"),o.setAttribute("data-translate","contact_btn_send");const t="contact_btn_send";TRANSLATIONS[t]?o.textContent=TRANSLATIONS[t]:o.textContent="Send Message"}}function initContactAnalytics(){const e=document.querySelectorAll("[data-analytics^='contact-']");e.length&&e.forEach(e=>{e.addEventListener("click",()=>{trackEvent("contact_click",{event_category:"engagement",event_label:e.dataset.analytics.replace("contact-",""),destination:e.dataset.destination||e.getAttribute("href")||""})})})}window.resetContactForm=function(){const e=document.getElementById("contact-form"),t=document.getElementById("contact-success"),n=document.getElementById("contact-submit-btn"),o=n?.querySelector(".btn-text");if(t&&(t.classList.remove("opacity-100"),t.classList.add("opacity-0"),setTimeout(()=>{t.classList.add("hidden")},500)),e&&e.reset(),n&&(n.disabled=!1,n.classList.remove("is-success","is-sending","cursor-not-allowed","opacity-80"),o)){o.setAttribute("data-translate","contact_btn_send");const e="contact_btn_send";TRANSLATIONS[e]?o.textContent=TRANSLATIONS[e]:o.textContent="Send Message"}},document.addEventListener("DOMContentLoaded",async()=>{let e;applyDocumentLanguage(),await loadTranslations(LANG,!0),initNavbar(),initContactIdentity(),MotionPreferences.prefersReducedMotion?document.documentElement.classList.add("reduced-motion"):(initCursor(),initInteractiveEffects()),initMarquee(),initScrollAnimations(),MotionPreferences.prefersReducedMotion||(initTimelineAnimation(),initPulseAnimations()),initProjectCardsAccessibility(),initCVDownload(),initContactForm(),initContactAnalytics(),updateLanguageToggle(),document.querySelectorAll(".js-lang-btn[data-lang]").forEach(e=>{e.addEventListener("click",()=>setLanguage(e.getAttribute("data-lang")))}),window.addEventListener("resize",()=>{clearTimeout(e);const t=document.getElementById("nav-lamp"),n=document.getElementById("lang-lamp"),o=document.getElementById("lang-lamp-hero");"undefined"!=typeof gsap&&(t&&gsap.to(t,{opacity:0,duration:.15,overwrite:!0}),n&&gsap.to(n,{opacity:0,duration:.15,overwrite:!0}),o&&gsap.to(o,{opacity:0,duration:.15,overwrite:!0})),e=setTimeout(()=>{const e=document.querySelector("nav.tubelight-nav");e&&(e.scrollLeft=0),navbarHighlight&&navbarHighlight.updateHighlight(),languageHighlight&&languageHighlight.updateHighlight(),heroLanguageHighlight&&heroLanguageHighlight.updateHighlight(),"undefined"!=typeof gsap&&(t&&gsap.to(t,{opacity:1,duration:.2,ease:"power2.out"}),n&&gsap.to(n,{opacity:1,duration:.2,ease:"power2.out"}),o&&gsap.to(o,{opacity:1,duration:.2,ease:"power2.out"}))},200)})}),window.addEventListener("load",()=>{DeviceDetector.isMobile?initMobileParticles():"function"==typeof window.requestIdleCallback?window.requestIdleCallback(()=>initThreeJS(),{timeout:2e3}):setTimeout(initThreeJS,1),"undefined"!=typeof lucide?lucide.createIcons():console.warn("Lucide icons not loaded!");const e=new ScrollManager;e.init(),window.scrollManager=e});